# Telegram Translator Bot

Многоязычный бот-переводчик для Telegram с админ-панелью, созданный с использованием aiogram 3.x.

## Описание

Бот позволяет переводить сообщения между различными языками, а также имеет ряд дополнительных функций:

- Автоматическое определение языка ввода
- История переводов
- Многоязычный интерфейс (русский и английский)
- Встроенные клавиатуры для удобной навигации
- Машина состояний (FSM) для сложных взаимодействий
- **Админ-панель** с функциями управления ботом
- Система блокировки пользователей
- Рассылка сообщений
- Статистика использования

## Авторы

- Бровкин Матвей Вадимович 465283
- Виноградская Серафима Дмитриевна 465404

## Установка и запуск

1. Клонируйте репозиторий
2. Установите зависимости:
```
pip install -r requirements.txt
```
3. Создайте файл `.env` по образцу `.env.example` и добавьте ваш BOT_TOKEN и ADMIN_IDS
4. Запустите бота:
```
python bot.py
```

## Конфигурация

### Переменные окружения (.env)

```env
BOT_TOKEN=your_bot_token_here
ADMIN_IDS=your_admin_user_id,another_admin_id
```

- `BOT_TOKEN` - токен бота от @BotFather
- `ADMIN_IDS` - ID администраторов через запятую (для доступа к админ-панели)

## Структура проекта

```
├── bot.py                 # Основной файл бота
├── config/                # Конфигурация бота
│   └── settings.py        # Настройки, токены и константы
│
├── filters/               # Фильтры aiogram
│   ├── admin_filter.py    # Фильтры для админ-панели
│   └── valid_text.py      # Валидация текста
│
├── keyboards/             # Клавиатуры для взаимодействия
│   ├── inline.py          # Inline-клавиатуры
│   └── reply.py           # Reply-клавиатуры
│
├── locales/               # Файлы локализации
│   ├── en.json            # Английский
│   └── ru.json            # Русский
│
├── middlewares/           # Middlewares aiogram
│   ├── antispam.py        # Антиспам защита
│   ├── antispam_config.py # Конфигурация антиспама
│   └── check_language.py  # Автоопределение языка
│
├── routers/               # Обработчики команд и сообщений
│   ├── commands.py        # Основные команды
│   └── handlers/          # Обработчики по функциональности
│       ├── admin.py       # Админ-панель
│       ├── settings.py    # Настройки языка
│       └── translation.py # Обработка переводов
│
├── services/              # Сервисы и внешние API
│   ├── api_client.py      # Клиент API перевода
│   └── history_storage.py # Хранение истории переводов
│
├── states/                # Состояния FSM
│   ├── admin_states.py    # Состояния админ-панели
│   └── language_state.py  # Состояния для выбора языка
│
├── storage/               # Файлы хранения данных
│   ├── banned_users.json  # Заблокированные пользователи
│   ├── history.json       # История переводов
│   └── user_settings.json # Настройки пользователей
│
└── utils/                 # Вспомогательные утилиты
    ├── formatters.py      # Форматирование сообщений
    └── logger.py          # Настройки логирования
```

## Команды бота

### Основные команды
- `/start` - Запуск бота и основное меню
- `/help` - Информация о боте и его возможностях
- `/translate` - Запуск режима перевода
- `/setlanguage` - Изменение языка интерфейса
- `/history` - Просмотр истории переводов
- `/clear_history` - Очистка истории переводов

### Команды администратора
- `/admin` - Открытие админ-панели (только для администраторов)
- `/stats` - Статистика использования бота
- `/broadcast` - Рассылка сообщений всем пользователям
- `/ban` - Блокировка пользователя
- `/unban` - Разблокировка пользователя
- `/banned_list` - Список заблокированных пользователей

## Функциональность FSM (конечных состояний)

1. **Состояния перевода** (`TranslateState`):
   - `waiting_for_text` - ожидание ввода текста для перевода

2. **Состояния языка** (`LanguageState`):
   - `waiting_for_language` - ожидание выбора языка интерфейса

3. **Состояния админ-панели** (`AdminState`):
   - `waiting_for_broadcast_message` - ожидание ввода сообщения для рассылки
   - `waiting_for_broadcast_confirmation` - ожидание подтверждения рассылки
   - `waiting_for_ban_user_id` - ожидание ввода ID пользователя для блокировки
   - `waiting_for_ban_confirmation` - ожидание подтверждения блокировки
   - `waiting_for_unban_user_id` - ожидание ввода ID пользователя для разблокировки
   - `waiting_for_unban_confirmation` - ожидание подтверждения разблокировки

## Админ-панель

Админ-панель предоставляет следующие возможности:

### Статистика
- Общее количество пользователей
- Количество переводов
- Активность пользователей

### Управление пользователями
- Блокировка/разблокировка пользователей
- Просмотр списка заблокированных пользователей
- Заблокированные пользователи не могут использовать бота

### Рассылка
- Отправка сообщений всем пользователям бота
- Предварительный просмотр сообщения
- Подтверждение перед отправкой
- Отчет о результатах рассылки

## Безопасность

- **Антиспам защита**: ограничение частоты сообщений (исключая админов)
- **Проверка прав**: доступ к админ-панели только для указанных в ADMIN_IDS пользователей
- **Валидация данных**: проверка корректности пользовательского ввода
- **Логирование**: запись всех действий для мониторинга

## Многоязычность

Бот поддерживает:
- **Английский** (en) - язык по умолчанию
- **Русский** (ru)

Автоматическое определение языка пользователя на основе настроек Telegram с возможностью ручного изменения через `/setlanguage`.